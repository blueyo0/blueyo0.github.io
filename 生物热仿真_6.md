# 前言
本文暂时作为笔记，记录推导Boundary-dispatch Method(BDM)的稳态温度分布计算的过程

# 传统BDM算法
方法来源于Harvard University的Shun-Chang Tsai老师提供的思路，我的mendeley里有相应论文。基础思路是内部温度由热源点和边界点决定，内部点的温度往往可表达为和这些点的线性关系，所以使用MC方式进行统计学计算，从而启发式地找到这种关系。

此文中的方法可分为双目和多目两种：

## 双目公式
双目只记录一个边界点最高温度$T_{max}$，每个边界点根据它自己的温度$T_b$发出$\frac{T_b}{T_{max}} \times N$个高能粒子，$\frac{T_{max}-T_b}{T_{max}} \times N$个低能粒子，最终根据每个位置经过的高能粒子占比计算温度，公式如下：

$$T_{i, j}=T_{\max } \frac{H_{i, j}}{H_{i, j}+L_{i, j}} \tag{1}$$

其中$H_{i,j}$和$L_{i,j}$分别代表高能粒子数和低能粒子数。

## 多目公式
多目将每个边界点作为，有$m$个边界点时，粒子被分类为$m$类，分别对应一个边界点。记录内部点$(i,j)$被第$k$类的粒子经过的次数为$V^k_{i,j}$，第$k$个边界点的温度为$T^k_b$，最终的温度为

$$
T_{i,j}=\frac{\sum^M_{k=1}{T^k_b V^k_{i,j}}}
{\sum^M_{k=1}{V^k_{i,j}}} \tag{2}
$$

更加充分地考虑了内部点和外部点的关系，使得每个内部点在理论上和所有边界点都建立了温度联系，但同时加大了算法的实现难度以及边界点数量增多后的处理难度。

# 我们的BDM算法
主要考虑到传统多目方法实现中的几个实际问题：

> - 只支持第一类边界条件，无法合理地处理对流边界
> - 随着模型规模增大，网格细化，边界点和网格点数量剧增，需要储存的粒子路径记录复杂度剧增，性能消耗难以接受

针对这两个问题，我们进行一些简单的改进：

> - 对流边界点发出的粒子变为双目的，高能粒子温度为$T_b$，低能粒子温度为$T_f$，其中低能粒子比例为$k|T_b-T_f| / T_b$，温差越大，低能粒子带来的对流修正占比就越高。

> - 将计算逻辑改为公式${(2.1)}$，先根据预设的一个$N$直接并行累加不同温度，中途记录总共经过的点数，并用来修正温度尺度。
> $$ T_{i,j}=\frac{\sum^M_{k=1}{T^k_b V^k_{i,j}}}{N} \times \frac{N}{\sum^M_{k=1}{V^k_{i,j}}} \tag{2.1} $$
 
> - 暂定的一点改进是给Particle添加方向，使得尽快收敛，需要数学论证合理性。



